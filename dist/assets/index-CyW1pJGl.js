(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();const u=require("express"),l=require("path"),{initializeApp:p,cert:f}=require("firebase-admin/app"),{getFirestore:m,Timestamp:g}=require("firebase-admin/firestore"),y=require("./scratch-axxes-firebase-adminsdk-fbsvc-21ad0f39dc.json");p({credential:f(y)});const d=m(),c=u(),a=3e3;c.use(u.static(l.join(__dirname,"public")));c.use(u.json());c.get("/",(n,t)=>{t.sendFile(l.join(__dirname,"public","index.html"))});c.get("/get-history",async(n,t)=>{try{const o=await d.collection("games").orderBy("date","desc").limit(3).get(),s=[];o.forEach(e=>{const r=e.data();s.push({pseudo:r.pseudo,result:r.result?"Gagné":"Perdu",date:r.date.toDate().toLocaleString()})}),t.json({success:!0,lastGames:s})}catch(o){console.error("Erreur lors de la récupération de l'historique :",o),t.status(500).json({success:!1,error:"Erreur interne du serveur"})}});c.post("/add-game",async(n,t)=>{const{pseudo:o,result:s}=n.body,e={pseudo:o,result:s,date:g.now()};try{const r=await d.collection("games").add(e);t.json({success:!0,gameId:r.id})}catch(r){console.error("Erreur lors de l'ajout de la participation :",r),t.status(500).json({success:!1,error:"Erreur interne du serveur"})}});c.listen(a,()=>{console.log(`Serveur en écoute sur le port ${a}`)});
